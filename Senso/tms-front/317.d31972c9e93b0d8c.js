"use strict";(self.webpackChunktms_front=self.webpackChunktms_front||[]).push([[317],{8317:(ut,A,o)=>{o.r(A),o.d(A,{SuperAdminModule:()=>mt});var m=o(6895),l=o(4006),f=o(1635),Z=o(4128),k=o(3470),e=o(4650),w=o(2025),z=o(2340),Y=o(529);let b=(()=>{class i{constructor(t,a){this.http=t,this.router=a,this.API_URL=z.N.apiUrl}fetchAllUsers(){return this.http.get(`${this.API_URL}/fetchAllUsers`)}fetchAllDevices(){return this.http.get(`${this.API_URL}/fetchAllDevices`)}fetchAllCounts(){return this.http.get(`${this.API_URL}/fetchAllCounts`)}dataHomeCharts(t){return this.http.get(`${this.API_URL}/getCountsDataForCharts/intervals?interval=${t}`)}fetchAllCompanies(){return this.http.get(`${this.API_URL}/fetchAllCompanies`)}fetchDeviceData(t){return this.http.get(`${this.API_URL}/fetchDeviceData/${t}`)}fetchLatestDeviceData(t){return this.http.get(`${this.API_URL}/fetchLatestDeviceData/${t}`)}fetchLatestEntryAllDevices(){return this.http.get(`${this.API_URL}/fetchLatestEntryAllDevices`)}}return i.\u0275fac=function(t){return new(t||i)(e.LFG(Y.eN),e.LFG(f.F0))},i.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();var _=o(5412),v=o(3546);let V=(()=>{class i{constructor(t,a,r,c){this.router=t,this.saService=a,this.service=r,this.dialog=c,this.ActiveDeviceData=[],this.DeactiveDeviceData=[],this.ActiveUsersData=[],this.DeactiveUsersData=[],this.timestampData=[]}ngOnInit(){this.fetchData()}fetchData(){(0,Z.D)({counts:this.service.fetchAllCounts(),chartData:this.service.dataHomeCharts("7day")}).subscribe({next:({counts:a,chartData:r})=>{this.data=a.counts[0],this.processChartData(r)},error:a=>{console.error(a)}})}processChartData(t){const a=t.data,r=198e5,c=(s,d)=>[new Date(s.bucket_start_time).getTime()+r,d?parseFloat(s[d]):s[d]];this.ActiveDeviceData=a.map(s=>c(s,"active_devices_count")),this.DeactiveDeviceData=a.map(s=>c(s,"deactive_devices_count")),this.ActiveUsersData=a.map(s=>c(s,"active_users_count")),this.DeactiveUsersData=a.map(s=>c(s,"inactive_users_count")),this.timestampData=a.map(s=>new Date(s.bucket_start_time).getTime()+r),this.createUsers(),this.createDevice()}createUsers(){k.chart("userLine",{chart:{type:"spline",zoomType:"xy"},title:{text:""},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{menuItems:["downloadCSV","downloadXLS"]}}},xAxis:{type:"datetime",timezoneOffset:330},yAxis:{title:{text:"Count"}},plotOptions:{spline:{dataLabels:{enabled:!1}}},series:[{name:"Active",color:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"#069e61"],[1,"#beebc9"]]},data:this.ActiveUsersData,marker:{radius:3}},{name:"Deactive",color:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"#d41204"],[1,"#e0d68b"]]},data:this.DeactiveUsersData,marker:{radius:3}}]})}createDevice(){k.chart("deviceLine",{chart:{type:"spline",zoomType:"xy"},title:{text:""},credits:{enabled:!1},exporting:{enabled:!0,buttons:{contextButton:{menuItems:["downloadCSV","downloadXLS"]}}},xAxis:{type:"datetime",timezoneOffset:330},yAxis:{title:{text:"Count"}},plotOptions:{spline:{dataLabels:{enabled:!1}}},series:[{name:"Live",color:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"#03a369"],[1,"#c2f2c2"]]},data:this.ActiveDeviceData,marker:{radius:3}},{name:"Disconnected",color:{linearGradient:{x1:0,x2:0,y1:0,y2:1},stops:[[0,"#e07d5e"],[1,"#ded954"]]},data:this.DeactiveDeviceData,marker:{radius:3}}]})}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.F0),e.Y36(w.l),e.Y36(b),e.Y36(_.uw))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-home"]],decls:105,vars:9,consts:[[1,"content","container-fluid"],[1,"row","pt-3","mb-3"],[1,"col-12"],[1,"row","title"],[1,"col-12","d-flex","justify-content-between"],[1,"col-lg-4","col-md-4","col-sm-12","mb-2"],[1,"device-card"],[1,"row"],[1,"col-12","mb-2"],[1,"title"],[1,"count-card","large-count"],[1,"count-number"],[1,"count-label"],[1,"col-6","mb-2"],[1,"count-card"],[1,"col-lg-6","col-md-6","col-sm-12","mb-2"],[1,"mb-2","data-charts"],["id","userLine",1,"chart-container"],["id","deviceLine",1,"chart-container"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card")(4,"mat-card-content")(5,"div",3)(6,"div",4)(7,"div"),e._uU(8,"Welcome to the dashboard"),e.qZA(),e.TgZ(9,"div"),e._uU(10,"Kaushal Pohekar"),e.qZA()()()()()()(),e.TgZ(11,"div",1)(12,"div",5)(13,"mat-card",6)(14,"mat-card-content")(15,"div",7)(16,"div",8)(17,"div",9),e._uU(18,"Users"),e.qZA()()(),e.TgZ(19,"div",7)(20,"div",8)(21,"div",10)(22,"div",11),e._uU(23),e.qZA(),e.TgZ(24,"div",12),e._uU(25,"Total Users"),e.qZA()()()(),e.TgZ(26,"div",7)(27,"div",13)(28,"div",14)(29,"div",11),e._uU(30),e.qZA(),e.TgZ(31,"div",12),e._uU(32,"Active"),e.qZA()()(),e.TgZ(33,"div",13)(34,"div",14)(35,"div",11),e._uU(36),e.qZA(),e.TgZ(37,"div",12),e._uU(38,"Inactive"),e.qZA()()()()()()(),e.TgZ(39,"div",5)(40,"mat-card",6)(41,"mat-card-content")(42,"div",7)(43,"div",8)(44,"div",9),e._uU(45,"Device Counts"),e.qZA()()(),e.TgZ(46,"div",7)(47,"div",8)(48,"div",10)(49,"div",11),e._uU(50),e.qZA(),e.TgZ(51,"div",12),e._uU(52,"Total Devices"),e.qZA()()()(),e.TgZ(53,"div",7)(54,"div",13)(55,"div",14)(56,"div",11),e._uU(57),e.qZA(),e.TgZ(58,"div",12),e._uU(59,"Active"),e.qZA()()(),e.TgZ(60,"div",13)(61,"div",14)(62,"div",11),e._uU(63),e.qZA(),e.TgZ(64,"div",12),e._uU(65,"Dissconnected"),e.qZA()()()()()()(),e.TgZ(66,"div",5)(67,"mat-card",6)(68,"mat-card-content")(69,"div",7)(70,"div",8)(71,"div",9),e._uU(72,"Organizations"),e.qZA()()(),e.TgZ(73,"div",7)(74,"div",8)(75,"div",10)(76,"div",11),e._uU(77),e.qZA(),e.TgZ(78,"div",12),e._uU(79,"Total"),e.qZA()()()(),e.TgZ(80,"div",7)(81,"div",13)(82,"div",14)(83,"div",11),e._uU(84),e.qZA(),e.TgZ(85,"div",12),e._uU(86,"Admin Users"),e.qZA()()(),e.TgZ(87,"div",13)(88,"div",14)(89,"div",11),e._uU(90),e.qZA(),e.TgZ(91,"div",12),e._uU(92,"Standard users"),e.qZA()()()()()()(),e.TgZ(93,"div",15)(94,"mat-card",16)(95,"mat-card-content")(96,"h5"),e._uU(97,"Users Status for Last 7 days"),e.qZA(),e._UZ(98,"div",17),e.qZA()()(),e.TgZ(99,"div",15)(100,"mat-card",16)(101,"mat-card-content")(102,"h5"),e._uU(103,"Devices Status for Last 7 days"),e.qZA(),e._UZ(104,"div",18),e.qZA()()()()()),2&t&&(e.xp6(23),e.Oqu((null==a.data?null:a.data.total_users)||0),e.xp6(7),e.Oqu((null==a.data?null:a.data.active_users_count)||0),e.xp6(6),e.Oqu((null==a.data?null:a.data.inactive_users_count)||0),e.xp6(14),e.Oqu((null==a.data?null:a.data.total_devices)||0),e.xp6(7),e.Oqu((null==a.data?null:a.data.active_devices_count)||0),e.xp6(6),e.Oqu((null==a.data?null:a.data.deactive_devices_count)||0),e.xp6(14),e.Oqu((null==a.data?null:a.data.organizations)||0),e.xp6(7),e.Oqu((null==a.data?null:a.data.admin_users_count)||0),e.xp6(6),e.Oqu((null==a.data?null:a.data.standard_users_count)||0))},dependencies:[v.a8,v.dn],styles:[".content[_ngcontent-%COMP%]{padding-top:50px;padding-bottom:20px;background-color:#f8f9fa}.title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;color:#343a40}.device-card[_ngcontent-%COMP%]{width:100%;min-height:200px;border-radius:8px;background-color:#fff;box-shadow:0 2px 4px #0000001a;overflow:hidden}.device-card-content[_ngcontent-%COMP%]{padding:20px;color:#212529}.count-card[_ngcontent-%COMP%]{background-color:#e9ecef;border-radius:6px;padding:15px;text-align:center;box-shadow:0 1px 2px #0000001a}.count-number[_ngcontent-%COMP%]{font-size:1.8rem;font-weight:700;color:#495057}.count-label[_ngcontent-%COMP%]{font-size:1rem;color:#6c757d;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.large-count[_ngcontent-%COMP%]   .count-number[_ngcontent-%COMP%]{font-size:2rem}@media (max-width: 767px){.device-card-content[_ngcontent-%COMP%]{padding:15px}.title[_ngcontent-%COMP%]{font-size:1rem}.count-card[_ngcontent-%COMP%]{padding:10px}.count-number[_ngcontent-%COMP%]{font-size:1.5rem}.large-count[_ngcontent-%COMP%]   .count-number[_ngcontent-%COMP%]{font-size:1.8rem}}.data-charts[_ngcontent-%COMP%]{height:40vh;width:100%;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.chart-container[_ngcontent-%COMP%]{height:35vh;display:flex;align-items:center;justify-content:center}"]}),i})();var g=o(7155),y=o(8739),J=o(4973),T=o(4859),D=o(9549),U=o(4385),p=o(3238);function Q(i,n){if(1&i&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.viewValue)}}function $(i,n){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Display By is "),e.TgZ(2,"strong"),e._uU(3,"required"),e.qZA()())}function j(i,n){if(1&i&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.viewValue)}}function X(i,n){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Device Type is "),e.TgZ(2,"strong"),e._uU(3,"required"),e.qZA()())}function H(i,n){if(1&i&&(e.TgZ(0,"div",5)(1,"mat-form-field",6)(2,"mat-label"),e._uU(3,"Device Type"),e.qZA(),e.TgZ(4,"mat-select",11),e.YNc(5,j,2,2,"mat-option",8),e.qZA(),e.YNc(6,X,4,0,"mat-error",9),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("formControl",t.deviceTypeControl),e.xp6(1),e.Q6J("ngForOf",t.deviceTypes),e.xp6(1),e.Q6J("ngIf",t.deviceTypeControl.hasError("required"))}}function W(i,n){if(1&i&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t.CompanyEmail),e.xp6(1),e.Oqu(t.CompanyName)}}function G(i,n){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," User Email is "),e.TgZ(2,"strong"),e._uU(3,"required"),e.qZA()())}function K(i,n){if(1&i&&(e.TgZ(0,"div",5)(1,"mat-form-field",6)(2,"mat-label"),e._uU(3,"User Email"),e.qZA(),e.TgZ(4,"mat-select",11),e.YNc(5,W,2,2,"mat-option",8),e.qZA(),e.YNc(6,G,4,0,"mat-error",9),e.qZA()()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("formControl",t.userEmailControl),e.xp6(1),e.Q6J("ngForOf",t.users),e.xp6(1),e.Q6J("ngIf",t.userEmailControl.hasError("required"))}}function ee(i,n){if(1&i&&(e.TgZ(0,"mat-option",16),e._uU(1),e.qZA()),2&i){const t=n.$implicit;e.Q6J("value",t.value),e.xp6(1),e.Oqu(t.viewValue)}}function te(i,n){1&i&&(e.TgZ(0,"mat-error"),e._uU(1," Sort By is "),e.TgZ(2,"strong"),e._uU(3,"required"),e.qZA()())}let ie=(()=>{class i{onWindowResize(){this.adjustDialogWidth()}adjustDialogWidth(){const t=window.innerWidth;this.dialogRef.updateSize(t<=600?"90%":t<=960?"70%":"400px","")}constructor(t,a,r,c){this.service=t,this.secureCookieService=a,this.dialogRef=r,this.data=c,this.displayByControl=new l.NI("",l.kI.required),this.deviceTypeControl=new l.NI({value:"",disabled:!0},l.kI.required),this.sortControl=new l.NI("",l.kI.required),this.userEmailControl=new l.NI({value:"",disabled:!0},l.kI.required),this.showDeviceType=!1,this.showUserEmail=!1,this.users=[],this.displayOptions=[{value:"all",viewValue:"All"},{value:"deviceType",viewValue:"Device Type"},{value:"user",viewValue:"Company Name"},{value:"online",viewValue:"Device Online"},{value:"offline",viewValue:"Device Offline"}],this.deviceTypes=[{value:"t",viewValue:"Temperature"},{value:"h",viewValue:"Humidity"},{value:"th",viewValue:"Temperature - TH"},{value:"ryb",viewValue:"Temperature - RYB"},{value:"ws",viewValue:"Water Flow Sensor"},{value:"fs",viewValue:"Flow Sensor"},{value:"ps",viewValue:"Pressure Sensor"},{value:"ts",viewValue:"Totalizer"},{value:"wl",viewValue:"Water Level"},{value:"tf",viewValue:"Transformer"}],this.allSortOptions=[{value:"deviceNameAsc",viewValue:"Device Name (Ascending)"},{value:"deviceNameDesc",viewValue:"Device Name (Descending)"},{value:"dateAsc",viewValue:"Date of Issue (Ascending)"},{value:"dateDesc",viewValue:"Date of Issue (Descending)"},{value:"statusOnline",viewValue:"Status (Online)"},{value:"statusOffline",viewValue:"Status (Offline)"},{value:"uniqueIdAsc",viewValue:"Unique ID (Ascending)"},{value:"uniqueIdDesc",viewValue:"Unique ID (Descending)"}],this.sortOptions=[...this.allSortOptions]}ngOnInit(){const t=this.displayOptions[0].value,a=this.allSortOptions[0].value;this.displayByControl.setValue(t),this.sortControl.setValue(a),this.deviceTypeControl.setValue(""),this.userEmailControl.setValue(""),this.updateDropdownVisibility(t);const r=this.secureCookieService.getDecryptedCookie("deviceFilters"),c=JSON.parse(r||"{}");c.displayBy&&(this.displayByControl.setValue(c.displayBy),this.deviceTypeControl.setValue(c.deviceType||""),this.sortControl.setValue(c.sort||a),this.userEmailControl.setValue(c.userEmail||""),this.updateDropdownVisibility(c.displayBy)),this.service.fetchAllCompanies().subscribe(s=>{this.users=s.companies},s=>{console.log(s)})}onDisplayByChange(){this.updateDropdownVisibility(this.displayByControl.value||"")}updateDropdownVisibility(t){this.showDeviceType="deviceType"===t,this.showUserEmail="user"===t,this.showDeviceType?this.deviceTypeControl.enable():this.deviceTypeControl.disable(),this.showUserEmail?this.userEmailControl.enable():this.userEmailControl.disable(),this.sortOptions="all"===t||"deviceType"===t||"user"===t?[...this.allSortOptions]:this.allSortOptions.filter(a=>"statusOnline"!==a.value&&"statusOffline"!==a.value)}applyFilters(){if(this.displayByControl.valid){if(this.showDeviceType&&!this.deviceTypeControl.valid||this.showUserEmail&&!this.userEmailControl.valid||!this.sortControl.valid)return;const a=JSON.stringify({displayBy:this.displayByControl.value,deviceType:this.deviceTypeControl.value,sort:this.sortControl.value,userEmail:this.userEmailControl.value});this.secureCookieService.setEncryptedCookie("deviceFilters",a)}this.dialogRef.close()}onNoClick(){this.dialogRef.close()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(J.T),e.Y36(_.so),e.Y36(_.WI))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-filter-device"]],hostBindings:function(t,a){1&t&&e.NdJ("resize",function(){return a.onWindowResize()},!1,e.Jf7)},decls:28,vars:8,consts:[[1,"container-fluid"],[1,"row","model-head","mb-2"],[1,"col-lg-12","col-md-12","col-sm-12","pt-1"],[1,"model-title"],[1,"row"],[1,"col-md-12","mb-2"],["appearance","fill",1,"from-field"],[3,"formControl","selectionChange"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["class","col-md-12 mb-2",4,"ngIf"],[3,"formControl"],[1,"col-md-6","justify-content-end","d-flex","mb-2"],["mat-raised-button","",3,"click"],[1,"col-md-6","mb-2"],["mat-raised-button","","color","primary",3,"click"],[3,"value"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),e._uU(4,"Apply Filter To Display List"),e.qZA()()(),e.TgZ(5,"div",4)(6,"div",5)(7,"mat-form-field",6)(8,"mat-label"),e._uU(9,"Display By"),e.qZA(),e.TgZ(10,"mat-select",7),e.NdJ("selectionChange",function(){return a.onDisplayByChange()}),e.YNc(11,Q,2,2,"mat-option",8),e.qZA(),e.YNc(12,$,4,0,"mat-error",9),e.qZA()(),e.YNc(13,H,7,3,"div",10),e.YNc(14,K,7,3,"div",10),e.TgZ(15,"div",5)(16,"mat-form-field",6)(17,"mat-label"),e._uU(18,"Sort By"),e.qZA(),e.TgZ(19,"mat-select",11),e.YNc(20,ee,2,2,"mat-option",8),e.qZA(),e.YNc(21,te,4,0,"mat-error",9),e.qZA()(),e.TgZ(22,"div",12)(23,"button",13),e.NdJ("click",function(){return a.onNoClick()}),e._uU(24,"Close"),e.qZA()(),e.TgZ(25,"div",14)(26,"button",15),e.NdJ("click",function(){return a.applyFilters()}),e._uU(27,"Save"),e.qZA()()()()),2&t&&(e.xp6(10),e.Q6J("formControl",a.displayByControl),e.xp6(1),e.Q6J("ngForOf",a.displayOptions),e.xp6(1),e.Q6J("ngIf",a.displayByControl.hasError("required")),e.xp6(1),e.Q6J("ngIf",a.showDeviceType),e.xp6(1),e.Q6J("ngIf",a.showUserEmail),e.xp6(5),e.Q6J("formControl",a.sortControl),e.xp6(1),e.Q6J("ngForOf",a.sortOptions),e.xp6(1),e.Q6J("ngIf",a.sortControl.hasError("required")))},dependencies:[m.sg,m.O5,l.JJ,l.oH,T.lW,D.KE,D.hX,D.TO,U.gD,p.ey],styles:[".model-head[_ngcontent-%COMP%]{background-color:#171718;height:50px;box-shadow:#32325d40 0 6px 12px -2px,#0000004d 0 3px 7px -3px;color:#f5f5f5;display:flex;justify-content:space-between;align-items:center}.model-title[_ngcontent-%COMP%]{text-align:center;font-size:1.2rem;font-weight:550}.from-field[_ngcontent-%COMP%]{width:100%}"]}),i})();var M=o(7392),ae=o(4850);function ne(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Device Details "),e.qZA())}function re(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",31),e._uU(2),e.qZA(),e.TgZ(3,"div",32),e._uU(4),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",t.DeviceName||"--"," "),e.xp6(2),e.hij(" ",t.DeviceUID||"--"," ")}}function se(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Device Type And Trigger "),e.qZA())}function oe(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",32),e._uU(2),e.qZA(),e.TgZ(3,"div",32),e._uU(4),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ","ryb"===t.DeviceType?"Busbar Temperaure":"th"===t.DeviceType?"Temperature & Humidity":"ts"===t.DeviceType?"Totalizer Sensor":"ws"===t.DeviceType?"Water Flow Sensor":"wl"===t.DeviceType?"Water Level Sensor":"ps"===t.DeviceType?"Pressure Sensor":"fs"===t.DeviceType?"Flow Sensor":"t"===t.DeviceType?"Temprature Sensor":"h"===t.DeviceType?"Humidity Sensor":"tf"===t.DeviceType?"Transformer Device":"Unknown"," "),e.xp6(2),e.hij(" ",t.TriggerValue||"--"," ")}}function ce(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Company Name And Location"),e.qZA())}function de(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",31),e._uU(2),e.qZA(),e.TgZ(3,"div",32),e._uU(4),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",t.CompanyName||"--"," "),e.xp6(2),e.hij(" ",t.DeviceLocation||"--"," ")}}function le(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Status "),e.qZA())}function me(i,n){1&i&&(e.ynx(0),e._uU(1," Live "),e.BQk())}function ue(i,n){1&i&&e._uU(0," Disconnected ")}const C=function(i,n){return{online:i,offline:n}};function ge(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",33),e.YNc(2,me,2,0,"ng-container",12),e.YNc(3,ue,1,0,"ng-template",null,34,e.W1O),e.qZA()()),2&i){const t=n.$implicit,a=e.MAs(4);e.xp6(1),e.Q6J("ngClass",e.WLB(3,C,"online"===t.status,"offline"===t.status)),e.xp6(1),e.Q6J("ngIf","online"===t.status)("ngIfElse",a)}}function pe(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Notification "),e.qZA())}function he(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",32),e._uU(2," Mailing:- "),e.TgZ(3,"span",35),e._uU(4),e.qZA()(),e._UZ(5,"mat-divider"),e.TgZ(6,"div",32),e._uU(7," Whats App:- "),e.TgZ(8,"span",35),e._uU(9),e.qZA()(),e._UZ(10,"mat-divider"),e.TgZ(11,"div",32),e._uU(12),e.qZA()()),2&i){const t=n.$implicit;e.xp6(3),e.Q6J("ngClass",e.WLB(5,C,"1"===t.Mail,"0"===t.Mail)),e.xp6(1),e.Oqu("1"===t.Mail?"Sending":"0"===t.Mail?"Stopped":"N/A"),e.xp6(4),e.Q6J("ngClass",e.WLB(8,C,"1"===t.Whatsapp,"0"===t.Whatsapp)),e.xp6(1),e.Oqu("1"===t.Whatsapp?"Sending":"0"===t.Whatsapp?"Stopped":"N/A"),e.xp6(3),e.hij(" Interval:- ",t.interval||"--"," ")}}function ve(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Contact and Mail "),e.qZA())}function fe(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",32),e._uU(2),e.qZA(),e.TgZ(3,"div",32),e._uU(4),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",t.ContactNO||"--"," "),e.xp6(2),e.hij(" ",t.PersonalEmail||"--"," ")}}function _e(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," IssueDate "),e.qZA())}function be(i,n){if(1&i&&(e.TgZ(0,"td",30)(1,"div",32),e._uU(2),e.ALo(3,"date"),e.qZA()()),2&i){const t=n.$implicit;e.xp6(2),e.hij(" ",e.xi3(3,1,t.IssueDate,"MMM d, y, h:mm a")," ")}}function we(i,n){1&i&&(e.TgZ(0,"th",29),e._uU(1," Action "),e.qZA())}function De(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"td",30)(1,"mat-icon",36),e.NdJ("click",function(){const c=e.CHM(t).$implicit,s=e.oxw(2);return e.KtG(s.onViewClick(c.DeviceUID))}),e._uU(2,"visibility"),e.qZA()()}}function ye(i,n){1&i&&e._UZ(0,"tr",37)}function Te(i,n){1&i&&e._UZ(0,"tr",38)}function Ce(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"table",16),e.ynx(2,17),e.YNc(3,ne,2,0,"th",18),e.YNc(4,re,5,2,"td",19),e.BQk(),e.ynx(5,20),e.YNc(6,se,2,0,"th",18),e.YNc(7,oe,5,2,"td",19),e.BQk(),e.ynx(8,21),e.YNc(9,ce,2,0,"th",18),e.YNc(10,de,5,2,"td",19),e.BQk(),e.ynx(11,22),e.YNc(12,le,2,0,"th",18),e.YNc(13,ge,5,6,"td",19),e.BQk(),e.ynx(14,23),e.YNc(15,pe,2,0,"th",18),e.YNc(16,he,13,11,"td",19),e.BQk(),e.ynx(17,24),e.YNc(18,ve,2,0,"th",18),e.YNc(19,fe,5,2,"td",19),e.BQk(),e.ynx(20,25),e.YNc(21,_e,2,0,"th",18),e.YNc(22,be,4,4,"td",19),e.BQk(),e.ynx(23,26),e.YNc(24,we,2,0,"th",18),e.YNc(25,De,3,0,"td",19),e.BQk(),e.YNc(26,ye,1,0,"tr",27),e.YNc(27,Te,1,0,"tr",28),e.qZA(),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("dataSource",t.dataSource),e.xp6(25),e.Q6J("matHeaderRowDef",t.displayedColumns),e.xp6(1),e.Q6J("matRowDefColumns",t.displayedColumns)}}function xe(i,n){1&i&&(e.TgZ(0,"div",39)(1,"h4"),e._uU(2,"No data found for this time interval."),e.qZA()())}let Ae=(()=>{class i{constructor(t,a,r,c){this.service=t,this.dialog=a,this.router=r,this.loading=c,this.displayedColumns=["deviceUID","deviceType","companyName","status","Mail","ContactNO","IssueDate","action"],this.dataSource=new g.by,this.deviceData=[]}ngOnInit(){this.loadData(),this.loading.isPageLoading(!0)}loadData(){this.service.fetchAllDevices().subscribe(t=>{this.deviceData=t.devices,this.applyFiltersAndSorting(),this.dataSource.data=this.deviceData,this.dataSource.paginator=this.paginator,this.loading.isPageLoading(!1)})}openFilterDialog(){const t=new _.vA;t.width="500px",t.height="auto",t.maxWidth="90vw",this.dialog.open(ie,t).afterClosed().subscribe(()=>{this.ngOnInit()})}applyFiltersAndSorting(){const t=sessionStorage.getItem("filters");if(t){const a=JSON.parse(t);"online"===a.displayBy?this.deviceData=this.deviceData.filter(r=>"online"===r.status):"offline"===a.displayBy?this.deviceData=this.deviceData.filter(r=>"offline"===r.status):"deviceType"===a.displayBy&&a.deviceType?this.deviceData=this.deviceData.filter(r=>r.DeviceType===a.deviceType):"user"===a.displayBy&&a.userEmail&&(this.deviceData=this.deviceData.filter(r=>r.CompanyEmail===a.userEmail)),a.sort&&this.sortDevices(a.sort)}}sortDevices(t){switch(t){case"deviceNameAsc":this.deviceData.sort((a,r)=>a.DeviceName.localeCompare(r.DeviceName));break;case"deviceNameDesc":this.deviceData.sort((a,r)=>r.DeviceName.localeCompare(a.DeviceName));break;case"dateAsc":this.deviceData.sort((a,r)=>new Date(a.IssueDate).getTime()-new Date(r.IssueDate).getTime());break;case"dateDesc":this.deviceData.sort((a,r)=>new Date(r.IssueDate).getTime()-new Date(a.IssueDate).getTime());break;case"statusOnline":this.deviceData.sort((a,r)=>"online"===a.status?-1:1);break;case"statusOffline":this.deviceData.sort((a,r)=>"offline"===a.status?-1:1);break;case"uniqueIdAsc":this.deviceData.sort((a,r)=>a.DeviceUID.localeCompare(r.DeviceUID));break;case"uniqueIdDesc":this.deviceData.sort((a,r)=>r.DeviceUID.localeCompare(a.DeviceUID))}}onViewClick(t){this.router.navigate(["/sa/devices",t])}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b),e.Y36(_.uw),e.Y36(f.F0),e.Y36(w.l))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-device"]],viewQuery:function(t,a){if(1&t&&e.Gf(y.NW,5),2&t){let r;e.iGM(r=e.CRH())&&(a.paginator=r.first)}},decls:22,vars:4,consts:[[1,"content"],[1,"container-fluid"],[1,"row","pt-4","mb-2"],[1,"col-12","mb-2"],[1,"row","d-flex","align-items-center","mb-2"],[1,"col-11"],[1,"col-1"],["mat-mini-fab","",1,"black-button",3,"click"],[1,"row"],[1,"col-12"],[1,"dataTable"],[1,"table-container",2,"overflow","auto","max-height","100%"],[4,"ngIf","ngIfElse"],["noData",""],[3,"hidden"],["showFirstLastButtons","",3,"pageSize"],["mat-table","",3,"dataSource"],["matColumnDef","deviceUID"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","deviceType"],["matColumnDef","companyName"],["matColumnDef","status"],["matColumnDef","Mail"],["matColumnDef","ContactNO"],["matColumnDef","IssueDate"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["mat-cell",""],[1,"data-title"],[1,"data-subtitle"],[1,"data-title",3,"ngClass"],["offlineText",""],[3,"ngClass"],[1,"view-button",3,"click"],["mat-header-row",""],["mat-row",""],[1,"msg"]],template:function(t,a){if(1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"h4"),e._uU(7,"Device Configuration"),e.qZA()(),e.TgZ(8,"div",6)(9,"button",7),e.NdJ("click",function(){return a.openFilterDialog()}),e.TgZ(10,"mat-icon"),e._uU(11,"filter_list"),e.qZA()()()(),e.TgZ(12,"div",8)(13,"div",9)(14,"mat-card",10)(15,"mat-card-content")(16,"div",11),e.YNc(17,Ce,28,3,"ng-container",12),e.YNc(18,xe,3,0,"ng-template",null,13,e.W1O),e.TgZ(20,"div",14),e._UZ(21,"mat-paginator",15),e.qZA()()()()()()()()()()),2&t){const r=e.MAs(19);e.xp6(17),e.Q6J("ngIf",a.dataSource.data.length>0)("ngIfElse",r),e.xp6(3),e.Q6J("hidden",0===a.dataSource.data.length),e.xp6(1),e.Q6J("pageSize",10)}},dependencies:[m.mk,m.O5,M.Hw,T.nh,y.NW,g.BZ,g.fO,g.as,g.w1,g.Dz,g.nj,g.ge,g.ev,g.XQ,g.Gk,ae.d,v.a8,v.dn,m.uU],styles:[".content[_ngcontent-%COMP%]{padding-top:50px;padding-bottom:20px}.data-title[_ngcontent-%COMP%]{font-size:.95rem;font-weight:550;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.data-subtitle[_ngcontent-%COMP%]{font-size:.8rem;font-weight:550;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.online[_ngcontent-%COMP%]{color:green}.offline[_ngcontent-%COMP%]{color:red}.black-button[_ngcontent-%COMP%]{background-color:#000;color:#fff}.view-button[_ngcontent-%COMP%]{cursor:pointer;color:#a1b0ab}"]}),i})();var O=o(7579),S=o(7445),I=o(8505),q=o(262),N=o(3900),L=o(2722),P=o(7009);function Ze(i,n){if(1&i&&(e.TgZ(0,"div",24)(1,"div",15)(2,"div",25)(3,"div",26),e._uU(4),e.qZA(),e.TgZ(5,"div",27),e._uU(6),e.qZA()()()()),2&i){const t=n.$implicit;e.xp6(4),e.Oqu(t.label),e.xp6(2),e.Oqu(t.value)}}function ke(i,n){1&i&&(e.TgZ(0,"div",28),e._uU(1," Live "),e.qZA())}function Ue(i,n){1&i&&(e.TgZ(0,"div",29),e._uU(1," Disconnect "),e.qZA())}function Me(i,n){if(1&i&&(e.TgZ(0,"div",3)(1,"div",15)(2,"div",16)(3,"div",17),e._uU(4),e.qZA(),e.TgZ(5,"div",18)(6,"div",30),e._UZ(7,"img",31),e.TgZ(8,"div",32),e._uU(9),e.qZA()()()()()()),2&i){const t=n.$implicit;e.xp6(4),e.Oqu(t.title),e.xp6(3),e.Q6J("src",t.image,e.LSH),e.xp6(2),e.AsE(" ",t.value," ",t.unit," ")}}let Oe=(()=>{class i{constructor(t,a,r,c,s){this.route=t,this.service=a,this.snackBar=r,this.router=c,this.loading=s,this.cards=[],this.deviceDetails=[],this.deviceConfig={th:[{title:"Temperature",image:"../../../../assets/img/tm.gif",unit:"\xb0C",value:()=>this.LatestData?.Temperature||0},{title:"Humidity",image:"../../../../assets/img/hm.gif",unit:"%",value:()=>this.LatestData?.Humidity||0}],t:[{title:"Temperature",image:"../../../../assets/img/tm.gif",unit:"\xb0C",value:()=>this.LatestData?.Temperature||0}],h:[{title:"Humidity",image:"../../../../assets/img/hm.gif",unit:"%",value:()=>this.LatestData?.Humidity||0}],ryb:[{title:"TemperatureR",image:"../../../../assets/img/tm.gif",unit:"\xb0C",value:()=>this.LatestData?.TemperatureR||0},{title:"TemperatureY",image:"../../../../assets/img/tm.gif",unit:"\xb0C",value:()=>this.LatestData?.TemperatureY||0},{title:"TemperatureB",image:"../../../../assets/img/tm.gif",unit:"\xb0C",value:()=>this.LatestData?.TemperatureB||0}],wl:[{title:"Water Level",image:"../../../../assets/img/wl.png",unit:"mm",value:()=>this.LatestData?.flowRate||0}],ws:[{title:"Flow Rate",image:"../../../../assets/img/ws1.png",unit:"L",value:()=>this.LatestData?.flowRate||0},{title:"Total Reading",image:"../../../../assets/img/meter-checker.png",unit:"L",value:()=>this.LatestData?.totalVolume||0}],ts:[{title:"Flow Rate",image:"../../../../assets/img/ws1.png",unit:"m\xb3",value:()=>this.LatestData?.flowRate||0},{title:"Total Reading",image:"../../../../assets/img/meter-checker.png",unit:"L",value:()=>this.LatestData?.totalVolume||0}],ps:[{title:"Pressure",image:"../../../../assets/img/ps.png",unit:"m\xb3/hr",value:()=>this.LatestData?.Pressure||0}],fs:[{title:"Flow Rate",image:"../../../../assets/img/ws1.png",unit:"KG",value:()=>this.LatestData?.flowRate||0},{title:"Total Reading",image:"../../../../assets/img/meter-checker.png",unit:"L",value:()=>this.LatestData?.totalVolume||0}],tf:[{title:"OTI Temperature",image:"../../../../assets/img/meter.jpg",unit:"\xb0C",value:()=>this.LatestData?.OTITemperature||0},{title:"WTI Temperature",image:"../../../../assets/img/meter.jpg",unit:"\xb0C",value:()=>this.LatestData?.WTITemperature||0},{title:"Transformer Efficiency",image:"../../../../assets/img/meter.jpg",unit:"\xb0C",value:()=>this.LatestData?.TransformerEfficiency||0}]},this.deviceTypeNames={ryb:"Busbar Temperature",th:"Temperature & Humidity",ts:"Totalizer Sensor",ws:"Water Flow Sensor",wl:"Water Level Sensor",ps:"Pressure Sensor",fs:"Flow Sensor",t:"Temperature Sensor",h:"Humidity Sensor",tf:"Transformer Device",unknown:"Unknown"},this.destroy$=new O.x}ngOnInit(){this.route.params.subscribe(t=>{this.DeviceUID=t.DeviceUID,this.fetchDeviceData(),this.startFetchingLatestData()}),this.loading.isPageLoading(!0)}fetchDeviceData(){(0,Z.D)({deviceData:this.service.fetchDeviceData(this.DeviceUID),latestData:this.service.fetchLatestDeviceData(this.DeviceUID)}).pipe((0,I.b)(({deviceData:t,latestData:a})=>{this.deviceData=t.deviceData[0]||{},this.DeviceFirstEntryData=t.firstEntry[0]||{},this.dataPointsCount=t.totalCount||0,this.deviceType=this.deviceData.DeviceType||"unknown",this.LatestData=a.deviceData||{},this.cards=this.deviceConfig[this.deviceType]?.map(r=>({...r,value:r.value()}))||[],this.updateDeviceDetails(),this.loading.isPageLoading(!1)}),(0,q.K)(t=>(console.error("Error fetching device data",t),this.snackBar.open("Error fetching device data. Redirecting...","Close",{duration:3e3}),setTimeout(()=>{this.router.navigate(["/sa/devices"])},3e3),[]))).subscribe()}startFetchingLatestData(){this.latestDataSubscription=(0,S.F)(5e3).pipe((0,N.w)(()=>this.service.fetchLatestDeviceData(this.DeviceUID)),(0,I.b)(t=>{this.LatestData=t.deviceData||{},this.updateDeviceDetails()}),(0,q.K)(t=>(console.error("Error fetching latest data",t),[])),(0,L.R)(this.destroy$)).subscribe()}isDeviceConnected(t){if(t){const a=new Date(t.TimeStamp),c=(new Date).getTime()-a.getTime();return Math.floor(c/1e3/60)<=10}return!1}getDeviceTypeName(t){return this.deviceTypeNames[t]||this.deviceTypeNames.unknown}updateDeviceDetails(){const t=(r,c=!1)=>{if(!r)return"N/A";const s=new Date(r),d={day:"numeric",month:"long",year:"numeric"};return c&&(d.hour="2-digit",d.minute="2-digit",d.second="2-digit",d.hour12=!0),s.toLocaleString("en-GB",d)};var r;this.deviceDetails=[{label:"Device Name",value:this.deviceData.DeviceName||"N/A"},{label:"Device Unique ID",value:this.deviceData.DeviceUID||"N/A"},{label:"Trigger",value:this.deviceData.TriggerValue||"N/A"},{label:"Device Location",value:this.deviceData.DeviceLocation||"N/A"},{label:"Device Type",value:this.getDeviceTypeName(this.deviceType)},{label:"Company Name",value:this.deviceData.CompanyName||"N/A"},{label:"Company Email",value:this.deviceData.CompanyEmail||"N/A"},{label:"Device Manager Mail Type",value:this.deviceData.PersonalEmail||"N/A"},{label:"Contact No",value:this.deviceData.ContactNO||"N/A"},{label:"Issue Date",value:t(this.deviceData.DeviceIssueDate)},{label:"Subscription End Date",value:t(this.deviceData.DeviceIssueDate?new Date(new Date(this.deviceData.DeviceIssueDate).setFullYear(new Date(this.deviceData.DeviceIssueDate).getFullYear()+1)).toISOString():void 0)},{label:"Data Received From",value:t(this.DeviceFirstEntryData.FirstEntryDate)},{label:"Sim Card Provider",value:this.deviceData.SimProvider||"N/A"},{label:"Sim Mobile No",value:this.deviceData.SimMobileNo||"N/A"},{label:"Sim Card Issue Date",value:t(this.deviceData.SimIssueDate)},{label:"Total Data Points",value:(r=this.dataPointsCount,null==r?"N/A":new Intl.NumberFormat("en-IN").format(r))},{label:"Latest Data Received Date",value:t(this.LatestData.TimeStamp,!0)}]}getRelativeTime(t){if(!t)return"N/A";const a="string"==typeof t?new Date(t):t;if(isNaN(a.getTime()))return"N/A";const c=(new Date).getTime()-a.getTime(),s=Math.floor(c/6e4);if(s<1)return"just now";if(s<60)return`${s} min${s>1?"s":""} ago`;const d=Math.floor(s/60);if(d<24)return`${d} hour${d>1?"s":""} ago`;const h=Math.floor(d/24);if(h<7)return`${h} day${h>1?"s":""} ago`;const u=Math.floor(h/7);if(u<4)return`${u} week${u>1?"s":""} ago`;const x=Math.floor(h/30);if(x<12)return`${x} month${x>1?"s":""} ago`;const E=Math.floor(h/365);return`${E} year${E>1?"s":""} ago`}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.latestDataSubscription&&this.latestDataSubscription.unsubscribe()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(f.gz),e.Y36(b),e.Y36(P.ux),e.Y36(f.F0),e.Y36(w.l))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-device-display"]],decls:48,vars:6,consts:[[1,"content"],[1,"container-fluid"],[1,"row","pt-4","mb-2"],[1,"col-12","mb-2"],[1,"row","mb-2"],[1,"col-12","d-flex","align-items-center","justify-content-between"],[1,"data"],[1,"row","mb-3"],[1,"col-lg-8","col-md-6","col-sm-12","mb-2"],[1,"row","d-flex","align-items-center"],[1,"col-12"],[1,"row"],["class","col-lg-4 col-md-12 mb-2",4,"ngFor","ngForOf"],[1,"col-lg-4","col-md-6","col-sm-12","mb-2"],[1,"col-6","mb-2"],[1,"card"],[1,"card-body"],[1,"data-title"],[1,"col-12","pt-2"],[1,"d-flex","justify-content-center","align-items-center"],[1,"image-text-2"],["class","live-tag",4,"ngIf"],["class","disconnected-tag",4,"ngIf"],["class","col-12 mb-2",4,"ngFor","ngForOf"],[1,"col-lg-4","col-md-12","mb-2"],[1,"card-body","text-center"],[1,"device-title"],[1,"device-main-title"],[1,"live-tag"],[1,"disconnected-tag"],[1,"d-flex","justify-content-between","align-items-center"],[1,"card-img",3,"src"],[1,"image-text"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"div",6),e._uU(7,"Device Data"),e.qZA(),e.TgZ(8,"div",6),e._uU(9),e.qZA()()()()(),e.TgZ(10,"div",7)(11,"div",8)(12,"mat-card")(13,"mat-card-content")(14,"div",9)(15,"div",10)(16,"h6"),e._uU(17,"Device Details"),e.qZA()(),e.TgZ(18,"div",10)(19,"div",11),e.YNc(20,Ze,7,2,"div",12),e.qZA()()()()()(),e.TgZ(21,"div",13)(22,"mat-card")(23,"mat-card-content")(24,"h6"),e._uU(25,"Device Real Time Data "),e.qZA(),e.TgZ(26,"div",11)(27,"div",14)(28,"div",15)(29,"div",16)(30,"div",17),e._uU(31,"Status"),e.qZA(),e.TgZ(32,"div",18)(33,"div",19)(34,"div",20),e.YNc(35,ke,2,0,"div",21),e.YNc(36,Ue,2,0,"div",22),e.qZA()()()()()(),e.TgZ(37,"div",14)(38,"div",15)(39,"div",16)(40,"div",17),e._uU(41,"Last Data Received"),e.qZA(),e.TgZ(42,"div",18)(43,"div",19)(44,"div",20),e._uU(45),e.qZA()()()()()()(),e.TgZ(46,"div",11),e.YNc(47,Me,10,4,"div",23),e.qZA()()()()()()()),2&t&&(e.xp6(9),e.Oqu(a.DeviceUID),e.xp6(11),e.Q6J("ngForOf",a.deviceDetails),e.xp6(15),e.Q6J("ngIf",a.isDeviceConnected(a.LatestData)),e.xp6(1),e.Q6J("ngIf",!a.isDeviceConnected(a.LatestData)),e.xp6(9),e.hij(" ",a.getRelativeTime(null==a.LatestData?null:a.LatestData.TimeStamp)||"N/A"," "),e.xp6(2),e.Q6J("ngForOf",a.cards))},dependencies:[m.sg,m.O5,v.a8,v.dn],styles:[".device-main-title[_ngcontent-%COMP%]{overflow:hidden;font-size:.9rem;white-space:nowrap;text-overflow:ellipsis;font-weight:550}.disconnected-tag[_ngcontent-%COMP%]{color:#d10f0f}.card-img[_ngcontent-%COMP%]{height:50px;width:auto}.image-text-2[_ngcontent-%COMP%]{text-align:center;justify-content:center;font-weight:600;font-size:1rem}.data-title[_ngcontent-%COMP%]{overflow:hidden;font-size:.95rem;text-overflow:ellipsis;white-space:nowrap;font-weight:550}.live-tag[_ngcontent-%COMP%]{color:#1f9c36}.content[_ngcontent-%COMP%]{padding-bottom:20px;padding-top:50px}.device-title[_ngcontent-%COMP%]{white-space:nowrap;font-weight:550;text-overflow:ellipsis;overflow:hidden;font-size:.8rem}.image-text[_ngcontent-%COMP%]{text-align:center;justify-content:center;font-size:25px;padding-top:10px;font-weight:600}.data[_ngcontent-%COMP%]{white-space:nowrap;text-overflow:ellipsis;overflow:hidden;font-weight:550;font-size:1.6rem}"]}),i})();function Se(i,n){1&i&&(e.TgZ(0,"div"),e._uU(1,"Loading page..."),e.qZA())}function Ie(i,n){if(1&i&&(e.TgZ(0,"div")(1,"h2"),e._uU(2,"Device Data"),e.qZA(),e.TgZ(3,"p")(4,"strong"),e._uU(5,"Device UID:"),e.qZA(),e._uU(6),e.qZA(),e.TgZ(7,"p")(8,"strong"),e._uU(9,"Temperature:"),e.qZA(),e._uU(10),e.qZA(),e.TgZ(11,"p")(12,"strong"),e._uU(13,"Flow Rate:"),e.qZA(),e._uU(14),e.qZA(),e.TgZ(15,"p")(16,"strong"),e._uU(17,"Pressure:"),e.qZA(),e._uU(18),e.qZA()()),2&i){const t=e.oxw();e.xp6(6),e.hij(" ",t.saService.deviceData.DeviceUID,""),e.xp6(4),e.hij(" ",t.saService.deviceData.Temperature,""),e.xp6(4),e.hij(" ",t.saService.deviceData.flowRate,""),e.xp6(4),e.hij(" ",t.saService.deviceData.Pressure,"")}}function qe(i,n){1&i&&(e.TgZ(0,"div"),e._uU(1," No data available for the device.\n"),e.qZA())}const Le=function(i,n){return{live:i,disconnected:n}};function Pe(i,n){if(1&i&&(e.TgZ(0,"div",3)(1,"mat-card")(2,"mat-card-content")(3,"div",4)(4,"div",5)(5,"div",6),e._uU(6),e.qZA(),e.TgZ(7,"div",7),e._uU(8),e.qZA(),e.TgZ(9,"div",8),e._uU(10),e.qZA()()()()()()),2&i){const t=n.$implicit;e.xp6(6),e.hij(" ",t.DeviceUID||"No Value"," "),e.xp6(1),e.Q6J("ngClass",e.WLB(4,Le,"Live"===t.status,"Disconnected"===t.status)),e.xp6(1),e.hij(" ",t.status,""),e.xp6(2),e.Oqu(t.timeAgo)}}const Re=[{path:"home",component:V},{path:"devices",component:Ae},{path:"users",component:(()=>{class i{constructor(t){this.saService=t}ngOnInit(){this.saService.connectToWebSocket()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(w.l))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-users"]],decls:3,vars:3,consts:[[4,"ngIf"]],template:function(t,a){1&t&&(e.YNc(0,Se,2,0,"div",0),e.YNc(1,Ie,19,4,"div",0),e.YNc(2,qe,2,0,"div",0)),2&t&&(e.Q6J("ngIf",a.saService.pageLoading),e.xp6(1),e.Q6J("ngIf",!a.saService.pageLoading&&a.saService.deviceData),e.xp6(1),e.Q6J("ngIf",!a.saService.dataLoading&&!a.saService.deviceData))},dependencies:[m.O5],styles:[".content[_ngcontent-%COMP%]{padding-top:50px;padding-bottom:20px}"]}),i})()},{path:"live",component:(()=>{class i{constructor(t){this.service=t,this.destroy$=new O.x,this.devices=[]}ngOnInit(){this.fetchData(),(0,S.F)(1e4).pipe((0,L.R)(this.destroy$),(0,N.w)(()=>this.service.fetchLatestEntryAllDevices())).subscribe(t=>{this.devices=this.processDeviceData(t.latestEntry||[])},t=>{console.error("Error fetching device data:",t)})}fetchData(){this.service.fetchLatestEntryAllDevices().subscribe(t=>{this.devices=this.processDeviceData(t.latestEntry||[])},t=>{console.error("Error fetching device data:",t)})}processDeviceData(t){const a=(new Date).getTime();return t.map(r=>{const c=new Date(r.TimeStamp).getTime(),s=a-c;let d="";if(s<=6e4)d="Just now";else if(s<=36e5){const u=Math.floor(s/6e4);d=`${u} minute${u>1?"s":""} ago`}else if(s<=864e5){const u=Math.floor(s/36e5);d=`${u} hour${u>1?"s":""} ago`}else if(s<=864e7){const u=Math.floor(s/864e5);d=`${u} day${u>1?"s":""} ago`}else d=new Date(r.TimeStamp).toLocaleString("en-US",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!0});const h=s<=3e5;return{...r,status:h?"Live":"Disconnected",timeAgo:d}})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b))},i.\u0275cmp=e.Xpm({type:i,selectors:[["app-live"]],decls:3,vars:1,consts:[[1,"content","container-fluid"],[1,"row","pt-3","mb-3"],["class","col-lg-2 col-md-3 col-sm-6 mb-2",4,"ngFor","ngForOf"],[1,"col-lg-2","col-md-3","col-sm-6","mb-2"],[1,"row"],[1,"col-12"],[1,"device-uid"],[1,"status",3,"ngClass"],[1,"time"]],template:function(t,a){1&t&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,Pe,11,7,"div",2),e.qZA()()),2&t&&(e.xp6(2),e.Q6J("ngForOf",a.devices))},dependencies:[m.mk,m.sg,v.a8,v.dn],styles:[".content[_ngcontent-%COMP%]{padding-top:50px;padding-bottom:20px;background-color:#f8f9fa}.device-uid[_ngcontent-%COMP%], .status[_ngcontent-%COMP%], .time[_ngcontent-%COMP%]{font-size:.9rem;font-weight:550}.live[_ngcontent-%COMP%]{color:green}.disconnected[_ngcontent-%COMP%]{color:red}"]}),i})()},{path:"devices/:DeviceUID",component:Oe},{path:"",redirectTo:"home",pathMatch:"full"}];let Fe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[f.Bz.forChild(Re),f.Bz]}),i})();var Be=o(7331),Ee=o(3683),ze=o(2673),Ye=o(6709),Ve=o(4144),Je=o(7084),Qe=o(6338),$e=o(8255);let Xe=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[p.BQ]}),i})();var He=o(3848),We=o(266),Ge=o(1572);o(2687),o(1281);let B=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({}),i})(),lt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[B,p.BQ,p.si,m.ez,B,p.BQ]}),i})(),mt=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({providers:[m.uU],imports:[m.ez,l.u5,l.UX,Fe,Be.Hi,M.Ps,Ee.g0,T.ot,ze.g,y.TU,g.p0,Ye.p9,D.lN,Ve.c,_.Is,Je.To,Qe.ie,v.QW,$e.Tx,Xe,He.Nh,We.AV,U.LD,Ge.Cq,P.ZX,lt]}),i})()}}]);